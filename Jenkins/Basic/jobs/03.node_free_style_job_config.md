# Jenkins Freestyle Job Configuration - Complete Guide

## Step 1: Create New Freestyle Job

### 1.1 Access Jenkins Dashboard
1. Open your browser and go to `http://localhost:8080` (or your Jenkins URL)
2. Login with your Jenkins credentials

### 1.2 Create New Item
1. Click **"New Item"** on the left sidebar
2. **Item name**: Enter `nodejs-app-cicd`
3. Select **"Freestyle project"**
4. Click **"OK"**

---

## Step 2: General Configuration

In the **General** section, configure these settings:

### ‚úÖ Basic Settings
- **Description**: 
  ```
  CI/CD pipeline for Node.js application with automated testing and deployment
  ```

### ‚úÖ GitHub Project (if using GitHub)
- ‚òëÔ∏è Check **"GitHub project"**
- **Project url**: `https://github.com/yourusername/your-repo-name/`

### ‚úÖ Build History Management
- ‚òëÔ∏è Check **"Discard old builds"**
- **Max # of builds to keep**: `10`
- **Max days to keep builds**: `30`

### ‚úÖ Project Parameters (Optional but Recommended)
- ‚òëÔ∏è Check **"This project is parameterized"**
- Click **"Add Parameter"** ‚Üí **"Choice Parameter"**
  - **Name**: `ENVIRONMENT`
  - **Choices**: 
    ```
    staging
    production
    ```
  - **Description**: `Select deployment environment`

---

## Step 3: Source Code Management

### ‚úÖ Git Configuration
1. Select **"Git"** (not "None")

2. **Repository URL**: 
   ```
   https://github.com/yourusername/your-nodejs-project.git
   ```

3. **Credentials**: 
   - Click **"Add"** ‚Üí **"Jenkins"**
   - **Kind**: `Username with password`
   - **Username**: Your GitHub username
   - **Password**: Your GitHub personal access token
   - **ID**: `github-credentials`
   - Click **"Add"**
   - Select the credential you just created

4. **Branches to build**:
   - **Branch Specifier**: `*/main` (or `*/master` if using master)

5. **Additional Behaviours** (Click "Add"):
   - **"Clean before checkout"** - ‚òëÔ∏è Check this
   - **"Clean after checkout"** - ‚òëÔ∏è Check this

---

## Step 4: Build Triggers

### ‚úÖ Automatic Triggers
Configure these triggers for automation:

1. ‚òëÔ∏è **"GitHub hook trigger for GITScm polling"**
   - This triggers builds when you push to GitHub

2. ‚òëÔ∏è **"Poll SCM"**
   - **Schedule**: `H/5 * * * *` (checks every 5 minutes as backup)

3. ‚òëÔ∏è **"Build periodically"** (Optional - for nightly builds)
   - **Schedule**: `H 2 * * *` (runs at 2 AM daily)

---

## Step 5: Build Environment

### ‚úÖ Environment Setup
Configure these environment options:

1. ‚òëÔ∏è **"Delete workspace before build starts"**
   - Ensures clean builds every time

2. ‚òëÔ∏è **"Add timestamps to the Console Output"**
   - Helps with debugging

3. ‚òëÔ∏è **"Use secret text(s) or file(s)"** (if you have secrets)
   - Click **"Add"** ‚Üí **"Secret text"**
   - **Variable**: `DATABASE_URL`
   - **Credentials**: [Select your secret]

---

## Step 6: Build Steps (The Main Configuration)

This is where you define what Jenkins actually does. Add multiple **"Execute shell"** build steps:

### Build Step 1: Environment Setup & Validation
- Click **"Add build step"** ‚Üí **"Execute shell"**
- **Command**:
```bash
#!/bin/bash
set -e

# Colors for better output
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo -e "${BLUE}üöÄ Starting CI/CD Pipeline${NC}"
echo "================================================"
echo "Build Number: $BUILD_NUMBER"
echo "Git Branch: $GIT_BRANCH" 
echo "Git Commit: $GIT_COMMIT"
echo "Workspace: $WORKSPACE"
echo "================================================"

# Check Node.js version
echo -e "${YELLOW}üìã Environment Information:${NC}"
which node || echo "Node.js not found in PATH"
node --version || echo "Cannot get Node version"
which npm || echo "NPM not found in PATH" 
npm --version || echo "Cannot get NPM version"
```

### Build Step 2: Install Dependencies
- Click **"Add build step"** ‚Üí **"Execute shell"**
- **Command**:
```bash
#!/bin/bash
set -e

echo -e "${BLUE}üì¶ Installing Node.js Dependencies${NC}"
echo "================================================"

# Clean install for consistent builds
if [ -f "package-lock.json" ]; then
    echo "Using npm ci for clean install..."
    npm ci
else
    echo "No package-lock.json found, using npm install..."
    npm install
fi

# Install dev dependencies for testing
echo "Installing dev dependencies..."
npm install --only=dev

echo -e "${GREEN}‚úÖ Dependencies installed successfully${NC}"
```

### Build Step 3: Code Quality & Security
- Click **"Add build step"** ‚Üí **"Execute shell"**
- **Command**:
```bash
#!/bin/bash
set -e

echo -e "${BLUE}üîç Running Code Quality Checks${NC}"
echo "================================================"

# Security audit
echo "Running security audit..."
npm audit --audit-level moderate || {
    echo -e "${YELLOW}‚ö†Ô∏è Security vulnerabilities found, please review${NC}"
}

# Linting (if available)
if npm run lint --silent 2>/dev/null; then
    echo "Running ESLint..."
    npm run lint
else
    echo -e "${YELLOW}‚ö†Ô∏è No lint script found in package.json${NC}"
fi

echo -e "${GREEN}‚úÖ Code quality checks completed${NC}"
```

### Build Step 4: Run Tests
- Click **"Add build step"** ‚Üí **"Execute shell"**
- **Command**:
```bash
#!/bin/bash
set -e

echo -e "${BLUE}üß™ Running Test Suite${NC}"
echo "================================================"

# Set test environment
export NODE_ENV=test

# Run tests with coverage
if npm run test:coverage --silent 2>/dev/null; then
    echo "Running tests with coverage..."
    npm run test:coverage
elif npm test --silent 2>/dev/null; then
    echo "Running basic tests..."
    npm test
else
    echo -e "${RED}‚ùå No test script found in package.json${NC}"
    exit 1
fi

# Check if tests generated coverage reports
if [ -d "coverage" ]; then
    echo -e "${GREEN}‚úÖ Test coverage report generated${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è No coverage report found${NC}"
fi

echo -e "${GREEN}‚úÖ All tests passed!${NC}"
```

### Build Step 5: Build Application
- Click **"Add build step"** ‚Üí **"Execute shell"**
- **Command**:
```bash
#!/bin/bash
set -e

echo -e "${BLUE}üèóÔ∏è Building Application${NC}"
echo "================================================"

# Build the application (if build script exists)
if npm run build --silent 2>/dev/null; then
    echo "Building application..."
    npm run build
    
    # Verify build output
    if [ -d "dist" ] || [ -d "build" ]; then
        echo -e "${GREEN}‚úÖ Build completed successfully${NC}"
        ls -la dist/ 2>/dev/null || ls -la build/ 2>/dev/null || echo "Build directory contents not accessible"
    else
        echo -e "${YELLOW}‚ö†Ô∏è Build completed but no dist/build directory found${NC}"
    fi
else
    echo -e "${YELLOW}‚ö†Ô∏è No build script found, skipping build step${NC}"
fi
```

### Build Step 6: Deployment (Conditional)
- Click **"Add build step"** ‚Üí **"Execute shell"**
- **Command**:
```bash
#!/bin/bash
set -e

echo -e "${BLUE}üöÄ Deployment Process${NC}"
echo "================================================"

# Only deploy from main/master branch
if [[ "$GIT_BRANCH" == "origin/main" ]] || [[ "$GIT_BRANCH" == "origin/master" ]] || [[ "$GIT_BRANCH" == "main" ]] || [[ "$GIT_BRANCH" == "master" ]]; then
    echo -e "${GREEN}‚úÖ Deploying from main branch${NC}"
    
    # Example deployment options (uncomment and modify as needed):
    
    # Option 1: Deploy to traditional server via SCP/SSH
    # echo "Deploying to production server..."
    # tar -czf app-${BUILD_NUMBER}.tar.gz dist/ package.json package-lock.json
    # scp app-${BUILD_NUMBER}.tar.gz user@your-server.com:/tmp/
    # ssh user@your-server.com "cd /var/www/your-app && tar -xzf /tmp/app-${BUILD_NUMBER}.tar.gz && npm install --production && pm2 restart your-app"
    
    # Option 2: Deploy using Docker
    # echo "Building Docker image..."
    # docker build -t your-app:${BUILD_NUMBER} .
    # docker tag your-app:${BUILD_NUMBER} your-app:latest
    # docker stop your-app || true
    # docker rm your-app || true
    # docker run -d --name your-app -p 3000:3000 your-app:latest
    
    # Option 3: Deploy to cloud (AWS, Heroku, etc.)
    # echo "Deploying to cloud service..."
    # Add your cloud deployment commands here
    
    # Placeholder deployment (replace with actual deployment)
    echo "üéØ Deployment configured - Replace this with your actual deployment commands"
    echo "Environment: ${ENVIRONMENT:-production}"
    echo "Build artifact ready for deployment"
    
    echo -e "${GREEN}‚úÖ Deployment completed successfully${NC}"
else
    echo -e "${YELLOW}‚è≠Ô∏è Skipping deployment - not main branch (current: $GIT_BRANCH)${NC}"
fi

echo -e "${GREEN}üéâ CI/CD Pipeline Completed Successfully!${NC}"
```

---

## Step 7: Post-build Actions

### ‚úÖ Archive Artifacts
1. Click **"Add post-build action"** ‚Üí **"Archive the artifacts"**
2. **Files to archive**: 
   ```
   dist/**, build/**, package.json, package-lock.json, coverage/**
   ```
3. ‚òëÔ∏è **"Archive artifacts only if build is successful"**

### ‚úÖ Publish Test Results (if you have XML test reports)
1. Click **"Add post-build action"** ‚Üí **"Publish JUnit test result report"**
2. **Test report XMLs**: 
   ```
   test-results.xml, coverage/junit.xml
   ```
3. ‚òëÔ∏è **"Allow empty results"**

### ‚úÖ Publish Coverage Reports (if using Istanbul/NYC)
1. Click **"Add post-build action"** ‚Üí **"Publish HTML reports"**
2. **HTML directory to archive**: `coverage/lcov-report`
3. **Index page[s]**: `index.html`
4. **Report title**: `Code Coverage Report`

### ‚úÖ Email Notifications
1. Click **"Add post-build action"** ‚Üí **"E-mail Notification"**
2. **Recipients**: `your-email@company.com, team@company.com`
3. ‚òëÔ∏è **"Send e-mail for every unstable build"**
4. ‚òëÔ∏è **"Send separate e-mails to individuals who broke the build"**

### ‚úÖ Slack Notifications (if you have Slack integration)
1. Click **"Add post-build action"** ‚Üí **"Slack Notifications"**
2. Configure your Slack webhook and channels

---

## Step 8: Advanced Configuration (Optional)

### ‚úÖ Build Timeout
In **Build Environment**:
- ‚òëÔ∏è **"Abort the build if it's stuck"**
- **Time-out strategy**: `Absolute time-out`
- **Timeout minutes**: `15`

### ‚úÖ Node.js Version Management
If you have multiple Node.js versions:
- ‚òëÔ∏è **"Provide Node & npm bin/ folder to PATH"**
- **Installation**: Select your Node.js version

---

## Step 9: Save and Test

### ‚úÖ Save Configuration
1. Click **"Save"** at the bottom of the page
2. You'll be redirected to the job's main page

### ‚úÖ Test Your Pipeline
1. Click **"Build Now"** to test your configuration
2. Click on the build number (e.g., `#1`) to see details
3. Click **"Console Output"** to see real-time logs

---

## Required package.json Scripts

Make sure your Node.js project has these scripts in `package.json`:

```json
{
  "scripts": {
    "start": "node server.js",
    "test": "jest",
    "test:coverage": "jest --coverage --coverageReporters=text-lcov --coverageReporters=html",
    "lint": "eslint . --ext .js,.jsx,.ts,.tsx",
    "build": "webpack --mode production",
    "dev": "nodemon server.js"
  },
  "devDependencies": {
    "jest": "^29.0.0",
    "eslint": "^8.0.0",
    "nodemon": "^2.0.0"
  }
}
```

---

## What Each Configuration Does (Simple Explanation)

### üîß **General Settings**
- **Project name & description**: Identifies your job
- **Build retention**: Keeps Jenkins storage manageable
- **Parameters**: Allows manual environment selection

### üì• **Source Code Management**
- **Git repository**: Where Jenkins gets your code
- **Credentials**: Secure access to private repos
- **Branch**: Which code branch to build
- **Clean checkout**: Ensures fresh code every time

### ‚ö° **Build Triggers**
- **GitHub webhook**: Instant builds on code push
- **SCM polling**: Backup trigger every 5 minutes
- **Scheduled builds**: Regular builds (like nightly)

### üèóÔ∏è **Build Steps**
- **Environment setup**: Prepares the build environment
- **Dependencies**: Installs required packages
- **Quality checks**: Runs linting and security audits
- **Testing**: Executes your test suite
- **Building**: Compiles/bundles your application
- **Deployment**: Pushes to production (if tests pass)

### üìã **Post-build Actions**
- **Artifacts**: Saves important files
- **Test reports**: Shows test results in Jenkins UI
- **Notifications**: Keeps team informed
- **Coverage reports**: Shows code coverage metrics

---

## Troubleshooting Common Issues

### ‚ùå "Node command not found"
**Solution**: Install NodeJS plugin or configure PATH
1. Go to **Manage Jenkins** ‚Üí **Global Tool Configuration**
2. Add Node.js installation
3. In your job, enable **"Provide Node & npm bin/ folder to PATH"**

### ‚ùå "Permission denied" during deployment
**Solution**: Configure SSH keys
1. Generate SSH key: `ssh-keygen -t rsa`
2. Add public key to target server
3. Add private key to Jenkins credentials

### ‚ùå "Tests fail in Jenkins but pass locally"
**Solution**: Environment differences
- Ensure same Node.js version
- Check environment variables
- Verify test database connectivity

### ‚ùå "Build times out"
**Solution**: Increase timeout or optimize build
- Increase timeout in Build Environment
- Use `npm ci` instead of `npm install`
- Cache node_modules between builds

---

This configuration gives you a complete, production-ready CI/CD pipeline that automatically tests and deploys your Node.js application with proper error handling, notifications, and reporting!